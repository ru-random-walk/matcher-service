# matcher-service
Подбор пользователей для прогулки исходя из предпочтений, наличия пользователя в группе. Хранение и менеджмент пользовательских «анкет», в которых описаны их предпочтения (через группы)

---
### Функциональные требования:

- поиск наиболее подходящих для прогулки пользователей среди ближайших
    - Фильтрация подходящих пользователей по группам
    - Быстрый поиск без фильтров
- Хранит все данные о пользовательских характеристиках(пол, возраст, координаты, список групп), на основе которых предлагает кандидатов
- Сервис должен гарантировать пользователю поиск кандидата, даже если уже найденый кандидат откажется от прогулки
- Должен быть всегда способен найти партнера для прогулки (даже если он находится на большом расстоянии, если пользователь это расстояние не ограничил)
- Хранит историю прогулок
- Отправка запроса на прогулку пользователю, с которым уже была прогулка

---
### Доменная модель

<img width="1012" alt="image" src="https://github.com/user-attachments/assets/1af6c056-31c9-4148-9e13-542dfae94662">

---
### Алгоритм подбора
П1 - текущий пользователь, управляющий приложением
П2 - подобранный для П1 пользователь

П1 задает свои окна доступа, вид фильтров по группам, сами группы для фильтра и радиус поиска П2. Нажимает кнопку поиска
Фильтры по группам двух видов: все подходят(ALL_MATCH)/хотя бы один подходит(ANY_MATCH)

0. Для П1 проверяем, что переданные окна доступа не пересекаются с текущими встречами, если пересечение есть, то отправляем ошибку
1. Для П1 ищется список встреч удовлетворяющих по радиусу, виду фильтра, группам из фильтра и статусу встречи = "IN_SEARCH":
- если вид=ALL_MATCH, то все группы из фильтра П1 должны быть = всем группам из фильтров встречи, ранее созданной П2
- если вид=ANY_MATCH, то хотя бы одна группа из фильтра П1 должна быть в фильтре групп из встречи, ранее созданной П2

2. Для найденных в (1) встреч проверяем окна доступа. 

2.1. Если окна встречи накладываются друг на друга (допустим, П1 доступен с 12 до 17, а П2 c 15 до 16), то привязываем П1 к ранее созданной П2 встрече. 

2.2. Если окна встречи не пересекаются, то создаем запись в таблице встреч для П1. Записываем туда: ID П1, координаты П1, вид фильтра по группам, список групп из фильтра, окна доступа П1. -- **Конец алгоритма** 

3. После того как П1 был привязан к встрече П2, отправляем запрос на создание чата в Chat-Service, меняем статус встречи на "APPOINTED".
